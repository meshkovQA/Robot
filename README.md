# 🤖 Веб-интерфейс управления роботом

## 📁 Репозиторий
https://github.com/meshkovQA/Robot.git

## 🚀 Быстрая установка

```bash
# Скачайте и запустите скрипт установки
wget https://raw.githubusercontent.com/meshkovQA/Robot/main/setup.sh
chmod +x setup.sh
./setup.sh

# Перезагрузите систему
sudo reboot
```

## 📂 Структура проекта

```
robot_web/
├── robot_server.py      # Flask веб-сервер
├── templates/
│   └── index.html       # HTML шаблон интерфейса
├── static/
│   ├── style.css        # CSS стили
│   └── script.js        # JavaScript код
├── start.sh            # Запуск сервиса
├── stop.sh             # Остановка сервиса
├── restart.sh          # Перезапуск сервиса
├── logs.sh             # Просмотр логов
├── status.sh           # Диагностика системы
├── update.sh           # Обновление с GitHub
└── README.md           # Документация
```

## ⚙️ Управление сервисом

### Скрипты управления
- `./start.sh` - запуск веб-сервера
- `./stop.sh` - остановка веб-сервера
- `./restart.sh` - перезапуск веб-сервера
- `./status.sh` - полная диагностика системы
- `./logs.sh` - просмотр логов в реальном времени
- `./update.sh` - обновление файлов с GitHub

### Systemctl команды
```bash
# Управление сервисом
sudo systemctl start robot-web.service
sudo systemctl stop robot-web.service
sudo systemctl restart robot-web.service
sudo systemctl status robot-web.service

# Автозапуск
sudo systemctl enable robot-web.service   # включить
sudo systemctl disable robot-web.service  # отключить
```

## 🌐 Доступ к интерфейсу

После установки веб-интерфейс доступен по адресу:
```
http://[IP-адрес-Raspberry-Pi]:5000
```

Узнать IP адрес:
```bash
hostname -I
```

## 🔄 Обновление проекта

Когда вы обновили файлы в GitHub репозитории:

```bash
cd /home/pi/robot_web
./update.sh
```

Скрипт `update.sh` автоматически:
- ✅ Создаст бэкапы текущих файлов
- ✅ Скачает новые версии с GitHub
- ✅ Проверит синтаксис Python
- ✅ Безопасно перезапустит сервер
- ✅ Проверит что все работает

## 🎮 Управление роботом

### Веб-интерфейс
- **Ползунки**: точное управление скоростью (-255 до +255) и углом руля (10° до 140°)
- **Кнопки**: быстрые команды (вперед, назад, танк повороты, стоп)
- **Мониторинг**: данные с датчиков в реальном времени
- **Безопасность**: автоматические предупреждения о препятствиях

### Управление с клавиатуры
- **W / ↑** - движение вперед
- **S / ↓** - движение назад  
- **A** - танковый поворот влево
- **D** - танковый поворот вправо
- **← / →** - поворот руля влево/вправо
- **Пробел** - остановка
- **C** - центрирование руля
- **Escape** - экстренная остановка

### Команды робота
Основные команды из вашего Arduino кода:
- `move_forward(speed)` - движение вперед
- `move_backward(speed)` - движение назад
- `tank_turn_left(speed)` - танковый поворот влево
- `tank_turn_right(speed)` - танковый поворот вправо
- `turn_left(angle)` - поворот руля влево
- `turn_right(angle)` - поворот руля вправо
- `stop()` - остановка
- `center_steering()` - центрирование руля

## 📊 Мониторинг системы

### Датчики
- **Передний ультразвуковой датчик** - расстояние до препятствий спереди
- **Задний ультразвуковой датчик** - расстояние до препятствий сзади
- **Цветовая индикация**:
  - 🟢 Зеленый: безопасно (>20см)
  - 🟡 Желтый: внимание (10-20см)  
  - 🔴 Красный: опасно (<10см)

### Индикаторы состояния
- **I2C Соединение** - связь с Arduino
- **Движение** - активность моторов
- **Препятствия** - обнаружение преград

## 🔧 API интерфейс

### Основные эндпоинты

```bash
# Универсальное управление движением
POST /api/move
Content-Type: application/json
{
    "speed": -255...255,
    "steering": 10...140
}

# Специфические команды
POST /api/command  
Content-Type: application/json
{
    "command": "move_forward|move_backward|tank_turn_left|tank_turn_right|stop|center_steering",
    "value": 150  // опционально
}

# Экстренная остановка
POST /api/emergency_stop

# Получение статуса и данных датчиков
GET /api/status
```

### Примеры API запросов

```bash
# Движение вперед со скоростью 200, руль прямо
curl -X POST http://192.168.1.100:5000/api/move \
  -H "Content-Type: application/json" \
  -d '{"speed": 200, "steering": 90}'

# Танковый поворот влево
curl -X POST http://192.168.1.100:5000/api/command \
  -H "Content-Type: application/json" \
  -d '{"command": "tank_turn_left", "value": 150}'

# Получение статуса
curl http://192.168.1.100:5000/api/status
```

## 🛡️ Системы безопасности

### Встроенные механизмы
- **Автоматическая остановка** при обнаружении препятствий
- **Тайм-аут команд** - остановка через 3 секунды без команд
- **Экстренная остановка** при потере веб-соединения
- **Предупреждения** о закрытии браузера во время движения
- **Автостоп** при переключении вкладки браузера

### Рекомендации по безопасности
1. **Всегда тестируйте на малых скоростях**
2. **Убедитесь в работе всех датчиков**
3. **Проверьте экстренную остановку**
4. **Не оставляйте робота без присмотра**
5. **Используйте в безопасном пространстве**

## 🔍 Устранение неполадок

### Диагностика проблем
```bash
# Полная диагностика системы
./status.sh

# Просмотр логов
./logs.sh

# Проверка I2C соединения
sudo i2cdetect -y 1

# Проверка сетевых подключений
sudo netstat -tlnp | grep :5000
```

### Частые проблемы

#### Веб-интерфейс недоступен с других устройств
```bash
# Проверить брандмауэр
sudo ufw status
sudo ufw allow 5000/tcp

# Перезапустить сервер
./restart.sh
```

#### Arduino не отвечает на I2C
```bash
# Проверить I2C устройства
sudo i2cdetect -y 1

# Должен показать устройство на адресе 0x08
# Если нет - проверить подключение и Arduino код
```

#### Сервис не запускается
```bash
# Проверить логи ошибок
sudo journalctl -u robot-web.service -n 50

# Проверить синтаксис Python
python3 -m py_compile robot_server.py
```

## 🛠️ Технические требования

### Аппаратное обеспечение
- **Raspberry Pi 4** (рекомендуется 4GB RAM)
- **Arduino Uno** с загруженным кодом управления
- **I2C соединение** между RPi и Arduino
- **Ультразвуковые датчики HC-SR04** (2 шт.)
- **L298N драйверы моторов**
- **Сервомотор** для рулевого управления

### Программное обеспечение
- **Raspberry Pi OS** (Bullseye или новее)
- **Python 3.8+**
- **Flask веб-фреймворк**
- **smbus2** для I2C коммуникации

### Поддерживаемые браузеры
- Chrome/Chromium (рекомендуется)
- Firefox
- Safari (iOS)
- Mobile Chrome (Android)

## 📚 Дополнительная информация

### Совместимость с вашим Arduino кодом
Веб-интерфейс полностью совместим с вашим существующим Arduino кодом:
- Использует те же I2C команды и структуры данных
- Поддерживает все ваши методы управления
- Работает с вашими датчиками и моторами

### Архитектура системы
- **Flask сервер** на Raspberry Pi обрабатывает веб-запросы
- **I2C протокол** для связи с Arduino
- **Arduino** выполняет низкоуровневое управление моторами и датчиками
- **Веб-интерфейс** предоставляет удобное управление

### Расширение функционала
Система легко расширяется:
- Добавление новых датчиков
- Интеграция камеры
- Подключение к системам умного дома
- API для внешних приложений

---

**Удачного управления роботом!** 🤖✨