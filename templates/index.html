<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ü§ñ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–±–æ—Ç–æ–º</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- –¢–≤–æ–π –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π CSS –ø–æ–≤–µ—Ä—Ö Bootstrap -->
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="bg-gradient">

  <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∞–ª–µ—Ä—Ç–æ–≤ (–æ—Å—Ç–∞–Ω–µ—Ç—Å—è —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–º —Å —Ç–≤–æ–µ–π showAlert) -->
  <div id="alert-container" class="position-fixed top-0 start-50 translate-middle-x mt-2 d-flex flex-column gap-2" style="z-index:9999;"></div>

  <div class="container-xxl py-2 vh-100 d-flex flex-column">
    <!-- –°—Ç–∞—Ç—É—Å-–±–∞—Ä -->
    <div class="d-flex flex-wrap align-items-center gap-2 py-2 border rounded bg-light">
      <span class="badge text-bg-secondary">
        <span id="connection-status" class="status-indicator me-1"></span> I2C —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
    </span>
        <span class="badge text-bg-secondary">
            <span id="movement-status" class="status-indicator me-1"></span> –î–≤–∏–∂–µ–Ω–∏–µ
        </span>
        <span class="badge text-bg-secondary">
            <span id="obstacle-status" class="status-indicator me-1"></span> –ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏—è
        </span>
        <span class="badge text-bg-secondary">
            <span id="camera-status" class="status-indicator me-1"></span> –ö–∞–º–µ—Ä–∞
        </span>
      <span class="ms-auto small">–û–±–Ω–æ–≤–ª–µ–Ω–æ: <strong id="last-update">--:--:--</strong></span>
    </div>

    <!-- –í–µ—Ä—Ö–Ω—è—è —Å—Ç—Ä–æ–∫–∞: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –∫–∞–º–µ—Ä–∞ -->
    <div class="row g-3 flex-grow-1 mt-2">
      <div class="col-12 col-lg-6 d-flex">
        <div class="card w-100">
          <div class="card-header text-center fw-bold">üéÆ –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è</div>
          <div class="card-body d-flex flex-column">
            <!-- –°–ª–∞–π–¥–µ—Ä —Å–∫–æ—Ä–æ—Å—Ç–∏ -->
            <label class="form-label">–°–∫–æ—Ä–æ—Å—Ç—å –¥–≤–∏–∂–µ–Ω–∏—è <span class="badge text-bg-dark ms-2" id="speed-value">100</span></label>
            <input type="range" class="form-range" id="speed-slider" min="50" max="255" value="100" step="10">

            <!-- –°–æ—Å—Ç–æ—è–Ω–∏–µ -->
            <div id="movement-status-display" class="alert alert-primary py-2 mt-2" role="alert">
              <strong>–°–æ—Å—Ç–æ—è–Ω–∏–µ:</strong> <span id="robot-state">–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</span><br>
              <small id="speed-info">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–∫–æ—Ä–æ—Å—Ç—å –∏ –Ω–∞–∂–º–∏—Ç–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</small>
            </div>

            <!-- –ö–Ω–æ–ø–∫–∏ -->
            <div class="row g-2 mt-1">
              <div class="col-4"></div>
              <div class="col-4 d-grid">
                <button class="btn btn-success" onclick="moveForward()">‚¨ÜÔ∏è –í–ø–µ—Ä–µ–¥</button>
              </div>
              <div class="col-4"></div>

              <div class="col-4 d-grid">
                <button class="btn btn-warning" onclick="tankTurnLeft()">üîÑ –ü–æ–≤–æ—Ä–æ—Ç ‚Üê</button>
              </div>
              <div class="col-4 d-grid">
                <button class="btn btn-danger" onclick="stopRobot()">‚èπÔ∏è –°—Ç–æ–ø</button>
              </div>
              <div class="col-4 d-grid">
                <button class="btn btn-warning" onclick="tankTurnRight()">üîÑ –ü–æ–≤–æ—Ä–æ—Ç ‚Üí</button>
              </div>

              <div class="col-4"></div>
              <div class="col-4 d-grid">
                <button class="btn btn-secondary" onclick="moveBackward()">‚¨áÔ∏è –ù–∞–∑–∞–¥</button>
              </div>
              <div class="col-4"></div>

              <div class="col-12 d-grid mt-2">
                <button class="btn btn-danger btn-lg" onclick="emergencyStop()">üö® –≠–ö–°–¢–†–ï–ù–ù–ê–Ø –û–°–¢–ê–ù–û–í–ö–ê</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- –ö–∞–º–µ—Ä–∞ -->
      <div class="col-12 col-lg-6 d-flex">
        <div class="card w-100">
          <div class="card-header fw-bold">üìπ –í–∏–¥–µ–æ–ø–æ—Ç–æ–∫</div>
          <div class="card-body d-flex flex-column">
            <!-- –í–∏–¥–µ–æ: –∑–∞–Ω–∏–º–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—É—é –≤—ã—Å–æ—Ç—É –∫–∞—Ä—Ç–æ—á–∫–∏ -->
            <div class="ratio ratio-16x9 flex-grow-1">
              <img id="camera-stream" src="/camera/stream" alt="–í–∏–¥–µ–æ–ø–æ—Ç–æ–∫"
                   onerror="this.src='/static/no-camera.png'" class="w-100 h-100 object-fit-contain rounded">
            </div>

            <!-- –ö–Ω–æ–ø–∫–∏ –∫–∞–º–µ—Ä—ã -->
            <div class="d-flex flex-wrap gap-2 justify-content-center my-2">
              <button class="btn btn-success" onclick="takePhoto()">üì∏ –§–æ—Ç–æ</button>
              <button class="btn btn-danger" id="record-btn" onclick="toggleRecording()">üé• –ó–∞–ø–∏—Å—å</button>
              <button class="btn btn-primary" onclick="refreshCamera()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
            </div>

            <!-- –ü–æ–≤–æ—Ä–æ—Ç/–Ω–∞–∫–ª–æ–Ω -->
            <div class="bg-dark-subtle rounded p-2">
              <div class="text-center fw-semibold mb-2">üéØ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–≤–æ—Ä–æ—Ç–æ–º –∫–∞–º–µ—Ä—ã</div>
              <div class="d-grid gap-2" style="max-width:200px;margin:0 auto;">
                <div class="d-flex justify-content-center">
                  <button class="btn btn-sm btn-outline-primary" onclick="cameraTiltUp()">‚¨ÜÔ∏è</button>
                </div>
                <div class="d-flex justify-content-between">
                  <button class="btn btn-sm btn-outline-danger" onclick="cameraPanLeft()">‚¨ÖÔ∏è</button>
                  <button class="btn btn-sm btn-outline-success" onclick="cameraCenter()">üéØ</button>
                  <button class="btn btn-sm btn-outline-danger" onclick="cameraPanRight()">‚û°Ô∏è</button>
                </div>
                <div class="d-flex justify-content-center">
                  <button class="btn btn-sm btn-outline-primary" onclick="cameraTiltDown()">‚¨áÔ∏è</button>
                </div>
              </div>
              <div class="text-center mt-2 small">
                –ì–æ—Ä–∏–∑–æ–Ω—Ç: <strong id="pan-angle">90¬∞</strong> &nbsp;|&nbsp;
                –í–µ—Ä—Ç–∏–∫–∞–ª—å: <strong id="tilt-angle">90¬∞</strong>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- –ù–∏–∂–Ω—è—è —Å—Ç—Ä–æ–∫–∞ -->
      <div class="col-12 col-lg-6 d-flex">
        <div class="card w-100">
          <div class="card-header fw-bold">üìä –î–∞—Ç—á–∏–∫–∏ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ</div>
          <div class="card-body">
            <div class="row g-2 small mb-2">
              <div class="col">–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å: <strong id="current-speed">100</strong></div>
              <div class="col">–°–æ—Å—Ç–æ—è–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è: <strong id="movement-direction">–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</strong></div>
              <div class="col">–ö–∞–º–µ—Ä–∞ FPS: <strong id="current-camera-fps">--</strong></div>
            </div>

            <div class="row g-3">
              <!-- –ü–µ—Ä–µ–¥–Ω–∏–π -->
                <div class="col-6">
                    <div id="front-sensor" class="sensor-card border rounded p-3 text-center">
                        <div class="fs-3 fw-bold text-success" id="front-distance">--</div>
                        <div class="text-muted">–ü–µ—Ä–µ–¥–Ω–∏–π –¥–∞—Ç—á–∏–∫ (—Å–º)</div>
                    </div>
                </div>

                <!-- –ó–∞–¥–Ω–∏–π -->
                <div class="col-6">
                    <div id="rear-sensor" class="sensor-card border rounded p-3 text-center">
                        <div class="fs-3 fw-bold text-success" id="rear-distance">--</div>
                        <div class="text-muted">–ó–∞–¥–Ω–∏–π –¥–∞—Ç—á–∏–∫ (—Å–º)</div>
                    </div>
                </div>

                <!-- –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ -->
                <div class="col-6">
                    <div id="temp-sensor" class="sensor-card border rounded p-3 text-center">
                        <div class="fs-3 fw-bold" id="temperature-value">--</div>
                        <div class="text-muted">–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (¬∞C)</div>
                    </div>
                </div>

                <!-- –í–ª–∞–∂–Ω–æ—Å—Ç—å -->
                <div class="col-6">
                    <div id="hum-sensor" class="sensor-card border rounded p-3 text-center">
                        <div class="fs-3 fw-bold" id="humidity-value">--</div>
                        <div class="text-muted">–í–ª–∞–∂–Ω–æ—Å—Ç—å (%)</div>
                    </div>
                </div>
            </div>

            <div id="obstacle-warnings" class="mt-2"></div>
          </div>
        </div>
      </div>

      <div class="col-12 col-lg-6 d-flex">
        <div class="card w-100">
          <div class="card-header fw-bold">üìÅ –§–∞–π–ª—ã –∫–∞–º–µ—Ä—ã</div>
          <div class="card-body">
            <div class="d-flex gap-2 mb-2 border-bottom pb-2">
              <button class="btn btn-primary" onclick="showFileTab('photos')">üì∏ –§–æ—Ç–æ</button>
              <button class="btn btn-primary" onclick="showFileTab('videos')">üé• –í–∏–¥–µ–æ</button>
            </div>
            <div id="photos-list" class="file-list">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            <div id="videos-list" class="file-list d-none">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            <div class="d-flex gap-2 justify-content-center mt-2">
              <button class="btn btn-primary" onclick="refreshFiles()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
              <button class="btn btn-danger" onclick="clearOldFiles()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap Bundle (JS + Popper) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <!-- –¢–≤–æ–∏ —Å–∫—Ä–∏–ø—Ç—ã -->
  <script src="{{ url_for('static', filename='script.js') }}"></script>
  <script src="{{ url_for('static', filename='camera.js') }}"></script>
  <script src="{{ url_for('static', filename='camera-control.js') }}"></script>
</body>
</html>